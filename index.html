<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Layar Hitam</title>
    <style>
        /* Make the entire page a black, clickable area */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: #000;
            cursor: pointer;
            /* Prevents the blue flash on tap in some mobile browsers */
            -webkit-tap-highlight-color: transparent;
        }
    </style>
</head>
<body>
    <!-- The body is intentionally left empty. The whole screen is the button. -->

    <script>
        // State variables to track the status
        let hasPermissionBeenGranted = false;
        let isTorchOn = false;
        let mediaStreamTrack = null;

        // The main function that runs on every click/tap
        const handleScreenTap = async () => {
            // --- First Tap: Request Permission ---
            if (!hasPermissionBeenGranted) {
                try {
                    // Request access to the rear camera to control the torch
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: 'environment' }
                    });
                    
                    // IMPORTANT: We get the permission but immediately stop the stream.
                    // This prevents the camera from staying active.
                    // The permission is now granted for this session.
                    stream.getTracks().forEach(track => track.stop());

                    hasPermissionBeenGranted = true;
                    // Optional: Vibrate slightly to confirm permission was granted
                    if ('vibrate' in navigator) {
                        navigator.vibrate(50);
                    }
                    console.log("Permission granted. Next tap will toggle the torch.");

                } catch (err) {
                    console.error("Permission denied or error:", err);
                    // If permission is denied, we can't do anything else.
                }
                return; // End the function here for the first tap
            }

            // --- Subsequent Taps: Toggle the Torch ---
            if (isTorchOn) {
                // Turn the torch OFF
                if (mediaStreamTrack) {
                    mediaStreamTrack.stop(); // Stop the camera track completely
                    mediaStreamTrack = null;
                }
                isTorchOn = false;
                console.log("Torch OFF");
            } else {
                // Turn the torch ON
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({
                        video: { facingMode: 'environment' }
                    });
                    
                    mediaStreamTrack = stream.getVideoTracks()[0];
                    
                    // Apply constraints to turn on the torch
                    await mediaStreamTrack.applyConstraints({
                        advanced: [{ torch: true }]
                    });

                    isTorchOn = true;
                    console.log("Torch ON");

                } catch (err) {
                    console.error("Could not turn on torch:", err);
                    // Reset state if it fails
                    hasPermissionBeenGranted = false; 
                }
            }
        };

        // Attach the event listener to the entire document
        document.documentElement.addEventListener('click', handleScreenTap);
    </script>
</body>
</html>